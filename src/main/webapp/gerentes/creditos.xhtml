<ui:composition template="/WEB-INF/template-user.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:jsf="http://xmlns.jcp.org/jsf"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
                >


    <ui:define name="content">

        <style>
            .ne-user-title{
                font-weight: bold;
                margin-right: 1em;
            }
        </style>



        <f:metadata>
            <f:viewParam name="referenciaPS" value="#{pagSeguroBean.referenciaPS}"></f:viewParam>
        </f:metadata>
        <div class="container">
            <div class="row">
                <h3>Confirmar Insercao de Credito</h3>
                <div class="stripes">
                    <span class="line"></span>
                </div>
                <div class="row ne-search">
                    <div class="col s12 img-responsive">
                        <h:form prependId="false">
                            <div class="row">
                                <div class="col s9 m10" >
                                    <input type="text" jsf:id="referenciaPS" placeholder="Codigo de referencia"  jsf:value="#{pagSeguroBean.referenciaPS}"  >
                                        <p:ajax event="blur"   process="referenciaPS" update="@form"/>
                                    </input>

                                </div>

                                <div class="col s3 m2">


                                    <h:commandLink value="Buscar" action="#{pagSeguroBean.transaction()}"
                                                   class="waves-effect waves-light btn btn-large green" style="margin-right: 2em">
                                        <f:ajax event="action" render=":ne-div-content "   ></f:ajax>
                                    </h:commandLink>

                                </div>




                            </div>
                            <p:messages rendered="#{pagSeguroBean.showCredits == false}" id="messages" autoUpdate="true" showDetail="true" closable="true"/>

                            <div jsf:id="ne-div-content">
                                <div class="row" jsf:rendered = "#{pagSeguroBean.showCredits}">
                                    <div class="row card light-green lighten-3" id="div-panel" style="margin-top: 4em; padding: 1.8em 0.5em">
                                        <div class="col s8 offset-s1">
                                            <p:messages  autoUpdate="true" showDetail="true" closable="true"/>

                                            <h3><span>Cliente:   </span><h:outputText value="#{pagSeguroBean.pagSeguro.user.name}" /></h3>
                                        </div>
                                        <div class="col s8 offset-s1">
                                            <h5><span>Login:</span><h:outputText style="margin-left:38%;"  value= "#{pagSeguroBean.pagSeguro.user.login}" /></h5>
                                        </div>

                                        <div class="col s8 offset-s1">
                                            <h5><span>Valor total:</span><h:outputText style="margin-left:30%;" value="R$ #{pagSeguroBean.pagSeguro.value}" /></h5>
                                        </div>
                                        <div class="col s8 offset-s1">
                                            <h5><span>Referencia:</span><h:outputText style="margin-left:30%;" value="#{pagSeguroBean.pagSeguro.referenciaPS}" /></h5>
                                        </div>

                                        <div class="col s8 offset-s1">

                                            <p:remoteCommand name="credit"  actionListener="#{pagSeguroBean.insertCredit(pagSeguroBean.pagSeguro)}" update="@all" />
                                            <p:remoteCommand name="refuse"  actionListener="#{pagSeguroBean.refuse(pagSeguroBean.pagSeguro)}" update="@all" />
                                            <h5 ><a onload=""  onclick="credit();"   onmouseover="" style="cursor: pointer;" ><span style="color:#1976d2">Confirmar</span></a><a onclick="refuse();"   onmouseover="" style="cursor: pointer;"><span style="margin-left:32%; color: #d32f2f;" >Recusar</span></a></h5>


                                        </div>

                                    </div>
                                </div>
                            </div>
                        </h:form>
                    </div>
                </div>
                <h5>Listagem</h5>
                <div class="stripes">
                    <span class="line"></span>
                </div>
                <h:form>
                    <div class="row">
                        <div class="col s12">

                            <p:dataTable var="pag" id="dtb"  value="#{pagSeguroBean.findAll()}"  paginator="true"

                                         paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                         rowsPerPageTemplate="5,10,15" rows="4"
                                         >


                                <p:column headerText="Cliente" sortBy="#{pag.user.name}" filterBy="#{pag.user.name}" filterMatchMode="contains" >
                                    <h:outputText value="#{pag.user.name}" />
                                </p:column>
                                <p:column headerText="Login" sortBy="#{pag.user.login}" filterBy="#{pag.user.login}" filterMatchMode="contains" >
                                    <h:outputText value="#{pag.user.login}" />
                                </p:column>
                                <p:column headerText="Referencia" sortBy="#{pag.referenciaPS}" filterBy="#{pag.referenciaPS}" filterMatchMode="contains" >
                                    <h:outputText value="#{pag.referenciaPS}" />
                                </p:column>

                                <p:column headerText="Estado" sortBy="#{pag.status}" filterBy="#{pag.status}" filterMatchMode="contains" >
                                    <h:outputText value="#{pag.status}" />
                                </p:column>
                                <p:column headerText="Valor" sortBy="#{pag.value}" filterBy="#{pag.value}" filterMatchMode="contains" >
                                    <h:outputText value="#{pag.value}" />
                                </p:column>


                                <p:column headerText="">
                                    <div class="row center">
                                        <div class="col s12 ">

                                            <h:commandLink action="#{pagSeguroBean.insertCredit(pag)}"   class="waves-effect waves-light btn green darken-3 white-text">
                                                <i class="material-icons">check_circle</i>
                                            </h:commandLink>
                                        </div>
                                        <div class="col s12">
                                            <h:commandLink action="#{pagSeguroBean.delete(pag)}" class="waves-effect waves-light btn red darken-3 white-text">
                                                <i class="material-icons">delete_forever</i>
                                            </h:commandLink>
                                        </div>
                                    </div>
                                </p:column>
                            </p:dataTable>
                        </div>
                    </div>
                </h:form>
            </div>
        </div>
    </ui:define>
</ui:composition>