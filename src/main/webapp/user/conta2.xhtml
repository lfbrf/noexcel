<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:jsf="http://xmlns.jcp.org/jsf"
                template="/WEB-INF/template-user.xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns = "http://www.w3.org/1999/xhtml"
                xmlns:pretty="http://ocpsoft.com/prettyfaces">

    <ui:define name="content">


        <div class="brown hide" style="height: 200px;"></div>
        <ul class="side-nav fixed transparent z-depth-0" style="width: 230px; margin-top: 5% !important; ">
            <li class="active"><a href="#"><i class="material-icons blue-text text-darken-1">dashboard</i>Dashboard</a></li>
            <li><a href="#"><i class="material-icons">store</i>Stores</a></li>
            <li><div class="divider"></div></li>
            <li><a href="#"><i class="material-icons">settings</i>Settings</a></li>
            <li><a href="#"><i class="material-icons">help</i>Help E Feedback</a></li>
        </ul>

        <div class="main">
            <div class="container-fluid">
                <div class="row">

                    <div class="col s12 m4">
                        <div class="card green  lighten-1 white-text">
                            <div class="card-content valign-wrapper">
                                <div class="card-text">
                                    <h6>Ver Conta</h6>
                                    <p>I am a very simple card.</p>
                                </div>
                                <div class="card-icon">

                                    <i class="material-icons medium valign">store</i>
                                </div>
                            </div>
                            <div class="card-action">
                                <a href="#">CLique aqui</a>
                            </div>
                        </div>
                    </div>
                    <div class="col s12 m4">
                        <div class="card blue  lighten-1 white-text">
                            <div class="card-content valign-wrapper">
                                <div class="card-text">
                                    <h6>Ver Extrato</h6>

                                    <p>I am a very simple card.</p>
                                </div>
                                <div class="card-icon">
                                    <i class="material-icons medium valign">description</i>
                                </div>
                            </div>
                            <div class="card-action">
                                <h:form>
                                    <p:commandLink onclick="

                                            document.getElementById('editar').style.display = 'none';
                                            document.getElementById('extrato').style.display = 'block';

                                                   "     >
                                        <h:outputText value="Clique aqui" />

                                    </p:commandLink>
                                </h:form>
                            </div>
                        </div>
                    </div>
                    <div class="col s12 m4">
                        <div class="card purple lighten-2 white-text">
                            <div class="card-content valign-wrapper">
                                <div class="card-text">
                                    <h6>Editar Perfil</h6>
                                    <p>I am a very simple card.</p>
                                </div>
                                <div class="card-icon">
                                    <i class="material-icons medium valign">build</i>
                                </div>
                            </div>
                            <div class="card-action">
                                <h:form>
                                    <p:remoteCommand name="myCommand" update="login-form" actionListener="#{userBean.getEmail(request.remoteUser)}"   />

                                    <p:commandLink

                                        onclick="
                                                myCommand();
                                                document.getElementById('editar').style.display = 'block';
                                                document.getElementById('extrato').style.display = 'none';

                                        " >
                                        <h:outputText value="Clique aqui" />

                                    </p:commandLink>
                                </h:form>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
        <h3>Ola, seja bem vindo #{userBean.getByra(request.remoteUser)}</h3>

        <div jsf:id="editar" style='display:none;'>
            <div class="row card light-green lighten-3"    >
                <div class="col s12" style="margin-top: 1em"><h4>Editar Conta</h4></div>
                <div class="col s12 center">
                    <img id="img-no-excel" src="http://lorempixel.com/200/200/"/>
                </div>
                <div class="col s12" style="padding: 3em 1em 1em 1em" jsf:id="me"  >
                    <h:form id="login-form" prependId="false" >

                        <div class="row">


                            <div class="col s11 input-field okname" >
                                <h:inputText id="name" required="true"  class="default-input" value="#{userBean.user.name}"   title="Informe seu nome completo"  onfocus="$(this).attr('placeholder', '');" onblur="$(this).attr('placeholder', 'Nome');"    requiredMessage="Campo nome e obrigatorio " />
                                <p:tooltip id="tool3" for="name" showEvent="focus" hideEvent="blur"  />

                            </div>

                            <div class="col s11 input-field">
                                <h:inputText id="email"   class="default-input"  title="Informe seu email"    value="#{userBean.user.email}" onfocus="$(this).attr('placeholder', '');" onblur="$(this).attr('placeholder', 'Email');"   required="true"  requiredMessage="Campo email e obrigatorio"/>
                                <p:tooltip id="tool4" for="email" showEvent="focus" hideEvent="blur"  />

                            </div>

                            <div class="col s11 input-field">
                                <p:password id="oldpass" required="true" value="#{userBean.user.password}"  class="default-input" title="Informe sua  senha atual"    placeholder="Senha Atual"  requiredMessage="Campo  senha e obrigatorio" onfocus="$(this).attr('placeholder', '');" onblur="$(this).attr('placeholder', 'Senha Atual');"  />
                                <p:tooltip id="tool8" for="oldpass" showEvent="focus" hideEvent="blur"  />
                            </div>

                            <div class="col s11 input-field">
                                <p:password id="pass" validatorMessage="Nova senha invalida, tente novamente"   match="repass"  class="default-input" title="Informe sua senha, deve conter ao menos um numero e uma letra"    placeholder="Nova Senha" value="#{userBean.npass}"   onfocus="$(this).attr('placeholder', '');" onblur="$(this).attr('placeholder', 'Senha');"  />
                                <p:tooltip id="tool5" for="pass" showEvent="focus" hideEvent="blur"  />
                                <span class="tip-message">A senha deve conter pelo menos um n√∫mero e 6 caracteres.</span>
                            </div>


                            <div class="col s11 input-field">
                                <p:password  id="repass"   class="default-input" title="Confirme a senha"  placeholder="Confirme a Senha" value="#{userBean.nrpass}" onfocus="$(this).attr('placeholder', '');" onblur="$(this).attr('placeholder', 'Confirme a Senha');"  />
                                <p:tooltip id="tool6" for="repass" showEvent="focus" hideEvent="blur"  />

                            </div>

                            <div class="col s12 input-field center ">

                                <p style="color:red; font-size: 12px">Apenas os campos nova senha e confirme nova senha sao opcionais.</p>
                                <p style="color:red; font-size: 12px">Caso precise efetuar outras alteracoes entre em contato com nossa equipe.</p>
                            </div>
                            <div class="col s7 button right-align">
                                <p:growl widgetVar="growlWV" life="5000" />

                                <h:commandButton actionListener="#{userBean.editProfile(request.remoteUser)}"      value="Editar"  class="btn green"   >

                                </h:commandButton>

                            </div>
                        </div>
                    </h:form>
                </div>
            </div>
        </div>


        <div jsf:id="extrato" style='display:none;'>
            <div class="row card light-green lighten-3"   >
                <div class="col s12" style="margin-top: 1em"><h4>Extrato</h4></div>
                <div class="col s12" style="padding: 3em 1em 1em 1em"  >


                    <h:form id="tabela" prependId="false"  >

                        <div class="row">
                            <div class="col s12">
                                <p:dataTable var="transaction" value="#{transactionBean.findAll(request.remoteUser)}"   paginator="true"
                                             paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                             rowsPerPageTemplate="5,10,15" rows="4"  >

                                    <p:column headerText="Data" class="center-align" sortBy="#{transaction.data}" filterBy="#{transaction.data}" filterMatchMode="contains"  >
                                        <h:outputText value="#{transaction.data}"  />
                                    </p:column>
                                    <p:column headerText="Operador" class="center-align" sortBy="#{transactionBean.getbyManager(transaction)}" filterBy="#{transactionBean.getbyManager(transaction)}" filterMatchMode="contains"  >
                                        <h:outputText value="#{transactionBean.getbyManager(transaction)}"  />
                                    </p:column>

                                    <p:column headerText="Produtos Consumidos" >
                                        <table>

                                            <ui:repeat var="group"  value="#{transactionBean.findProducts(transaction.id)}">
                                                <tr>
                                                    <td> <h:outputText value="#{productBean.findByid(group.product.id).getName()}" /></td>
                                                    <td> R$-<h:outputText  value="#{productBean.findByid(group.product.id).getValue()}" /></td>

                                                </tr>
                                            </ui:repeat>
                                            <ui:repeat var="group" rendered="#{transaction.value>0}"  value="#{transactionBean.findProducts(transaction.id) == null}">
                                                <tr>
                                                    <td> <h:outputText value="Adi√ßao" /></td>
                                                    <td> R$+<h:outputText  value="#{transaction.value}" /></td>

                                                </tr>
                                            </ui:repeat>

                                        </table>
                                    </p:column>
                                    <p:column headerText="Valor Total" class="center-align"  sortBy="#{transaction.value}" filterBy="#{transaction.value}" filterMatchMode="contains"  >
                                        <h:outputText value="#{transaction.value}" />
                                        <input type="hidden" name="valor" value="#{transaction.value}" />
                                    </p:column>

                                </p:dataTable>
                            </div>
                        </div>
                    </h:form>
                </div>
            </div>
        </div>


    </ui:define>
</ui:composition>