<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:jsf="http://xmlns.jcp.org/jsf"
                template="/WEB-INF/templateu.xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns = "http://www.w3.org/1999/xhtml"
                xmlns:pretty="http://ocpsoft.com/prettyfaces">

    <ui:define name="content">

        <h:form>
            <div class="brown hide" style="height: 200px;"></div>
            <ul class="side-nav fixed transparent z-depth-0" style="width: 218px; margin-top: 5% !important; ">
                <li id="ct" ><p:commandLink style="font-weight: bold; font-size: 15px !important;" onclick="
                        document.getElementById('et').classList.remove('active');
                        document.getElementById('ct').classList.add('active');
                        document.getElementById('ed').classList.remove('active');
                        document.getElementById('editar').style.display = 'none';
                        document.getElementById('conta').style.display = 'block';
                        document.getElementById('extrato').style.display = 'none';

                                            "     >

                        <i class="material-icons blue-text text-darken-1">dashboard</i>Conta</p:commandLink></li>
                <li id="et"><p:commandLink style="font-weight: bold; font-size: 15px !important;" onclick="
                        document.getElementById('et').classList.add('active');
                        document.getElementById('ct').classList.remove('active');
                        document.getElementById('ed').classList.remove('active');
                        document.getElementById('editar').style.display = 'none';
                        document.getElementById('conta').style.display = 'none';
                        document.getElementById('extrato').style.display = 'block';

                                           "     ><i class="material-icons">description</i>Extrato </p:commandLink></li>
                <li><div class="divider"></div></li>
                <li id="ed"><p:commandLink style="font-weight: bold; font-size: 15px !important;" onclick="
                        document.getElementById('et').classList.remove('active');
                        document.getElementById('ct').classList.remove('active');
                        document.getElementById('ed').classList.add('active');
                        document.getElementById('editar').style.display = 'block';
                        document.getElementById('conta').style.display = 'none';
                        document.getElementById('extrato').style.display = 'none';

                                           "     >
                        <i class="material-icons">settings</i>Perfil</p:commandLink></li>

            </ul>
        </h:form>




        <h3>Ola, seja bem vindo #{userBean.getByra(request.remoteUser)}</h3>
        <div class="main">
            <div class="container-fluid">
                <div class="row">

                    <div class="col s12 m4">
                        <div class="card green  lighten-1 white-text">
                            <div class="card-content valign-wrapper">
                                <div class="card-text">
                                    <h6>Ver Conta</h6>
                                    <p>Saldo e informacoes basicas.</p>
                                </div>
                                <div class="card-icon">

                                    <i class="material-icons medium valign">store</i>
                                </div>
                            </div>
                            <div class="card-action">
                                <h:form>
                                    <p:commandLink onclick="
                                            document.getElementById('et').classList.remove('active');
                                            document.getElementById('ct').classList.add('active');
                                            document.getElementById('ed').classList.remove('active');
                                            document.getElementById('editar').style.display = 'none';
                                            document.getElementById('extrato').style.display = 'none';
                                            document.getElementById('conta').style.display = 'block';

                                                   "     >
                                        <h:outputText value="Clique aqui" />

                                    </p:commandLink>
                                </h:form>
                            </div>
                        </div>
                    </div>
                    <div class="col s12 m4">
                        <div class="card blue  lighten-1 white-text">
                            <div class="card-content valign-wrapper">
                                <div class="card-text">
                                    <h6>Ver Extrato</h6>

                                    <p>Detalhar todas as Refeicoes </p>
                                </div>
                                <div class="card-icon">
                                    <i class="material-icons medium valign">description</i>
                                </div>
                            </div>
                            <div class="card-action">
                                <h:form>
                                    <p:commandLink onclick="
                                            document.getElementById('et').classList.add('active');
                                            document.getElementById('ct').classList.remove('active');
                                            document.getElementById('ed').classList.remove('active');
                                            document.getElementById('editar').style.display = 'none';
                                            document.getElementById('conta').style.display = 'none';
                                            document.getElementById('extrato').style.display = 'block';

                                                   "     >
                                        <h:outputText value="Clique aqui" />

                                    </p:commandLink>
                                </h:form>
                            </div>
                        </div>
                    </div>
                    <div class="col s12 m4">
                        <div class="card purple lighten-2 white-text">
                            <div class="card-content valign-wrapper">
                                <div class="card-text">
                                    <h6>Editar Perfil</h6>
                                    <p>Editar as informacoes.</p>
                                </div>
                                <div class="card-icon">
                                    <i class="material-icons medium valign">settings</i>
                                </div>
                            </div>
                            <div class="card-action">




                                <h:form>
                                    <p:remoteCommand name="myCommand" update="login-form" actionListener="#{userBean.getEmail(request.remoteUser)}"   />

                                    <p:commandLink

                                        onclick="
                                                myCommand();
                                                document.getElementById('et').classList.remove('active');
                                                document.getElementById('ct').classList.remove('active');
                                                document.getElementById('ed').classList.add('active');
                                                document.getElementById('editar').style.display = 'block';
                                                document.getElementById('conta').style.display = 'none';
                                                document.getElementById('extrato').style.display = 'none';

                                        " >
                                        <h:outputText value="Clique aqui" />

                                    </p:commandLink>
                                </h:form>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>


        <div jsf:id="editar" style='display:none;'>
            <div class="row card deep-purple lighten-3"    >
                <div class="col s12 offset-s5" style="margin-top: 1em"><h4>Editar Conta</h4></div>
                <div class="col s12" style="padding: 3em 1em 1em 1em" jsf:id="me"  >
                    <h:form>
                        <div class="col s12 center" jsf:id="data">
                            <img id="img-no-excel" src="/images/#{userBean.avatar(request.remoteUser)}" style="max-height: 200px; max-width: 200px;"/>
                        </div>


                        <input  type="hidden" name="login" value="#{request.remoteUser}"  />


                        <p:outputLabel value="Imagem de perfil" for="fileUpload" style="color:black"/>
                        <p:fileUpload id="fileUpload"
                                      fileUploadListener="#{uploadAvancadoBean.upload}"
                                      update="data" label="Escolher" uploadLabel="Enviar"
                                      cancelLabel="Cancelar" allowTypes="/(\.|\/)(gif|jpg|png)$/"
                                      invalidFileMessage="São permitidas somente imagens (gif, jpeg, jpg e png)"
                                      sizeLimit="10240000"
                                      invalidSizeMessage="O tamanho máximo permitido é de 1KB."
                                      fileLimit="5"
                                      fileLimitMessage="Adicione apenas uma imagem"
                                      multiple="false" auto="false"
                                      onstart="console.log('Iniciando envio de arquivo')"
                                      onerror="console.log('Erro na requisição de envio')"
                                      oncomplete="console.log('Envio concluído')" />


                    </h:form>





                    <h:form id="login-form" prependId="false" >

                        <div class="row">


                            <div class="col s11 input-field okname" >
                                <h:inputText id="name" required="true"  class="default-input" value="#{userBean.user.name}"   title="Informe seu nome completo"  onfocus="$(this).attr('placeholder', '');" onblur="$(this).attr('placeholder', 'Nome');"    requiredMessage="Campo nome e obrigatorio " />
                                <p:tooltip id="tool3" for="name" showEvent="focus" hideEvent="blur"  />

                            </div>

                            <div class="col s11 input-field">
                                <h:inputText id="email"   class="default-input"  title="Informe seu email"    value="#{userBean.user.email}" onfocus="$(this).attr('placeholder', '');" onblur="$(this).attr('placeholder', 'Email');"   required="true"  requiredMessage="Campo email e obrigatorio"/>
                                <p:tooltip id="tool4" for="email" showEvent="focus" hideEvent="blur"  />

                            </div>

                            <div class="col s11 input-field">
                                <p:password id="oldpass" required="true" value="#{userBean.user.password}"  class="default-input" title="Informe sua  senha atual"    placeholder="Senha Atual"  requiredMessage="Campo  senha e obrigatorio" onfocus="$(this).attr('placeholder', '');" onblur="$(this).attr('placeholder', 'Senha Atual');"  />
                                <p:tooltip id="tool8" for="oldpass" showEvent="focus" hideEvent="blur"  />
                            </div>

                            <div class="col s11 input-field">
                                <p:password id="pass" validatorMessage="Nova senha invalida, tente novamente"   match="repass"  class="default-input" title="Informe sua senha, deve conter ao menos um numero e uma letra"    placeholder="Nova Senha" value="#{userBean.npass}"   onfocus="$(this).attr('placeholder', '');" onblur="$(this).attr('placeholder', 'Senha');"  />
                                <p:tooltip id="tool5" for="pass" showEvent="focus" hideEvent="blur"  />
                                <span class="tip-message">A senha deve conter pelo menos um número e 6 caracteres.</span>
                            </div>


                            <div class="col s11 input-field">
                                <p:password  id="repass"   class="default-input" title="Confirme a senha"  placeholder="Confirme a Senha" value="#{userBean.nrpass}" onfocus="$(this).attr('placeholder', '');" onblur="$(this).attr('placeholder', 'Confirme a Senha');"  />
                                <p:tooltip id="tool6" for="repass" showEvent="focus" hideEvent="blur"  />

                            </div>

                            <div class="col s12 input-field center ">

                                <p style="color:red; font-size: 12px">Apenas os campos nova senha e confirme nova senha sao opcionais.</p>
                                <p style="color:red; font-size: 12px">Caso precise efetuar outras alteracoes entre em contato com nossa equipe.</p>
                            </div>
                            <div class="col s7 button right-align">
                                <p:growl widgetVar="growlWV" life="5000" />

                                <h:commandButton actionListener="#{userBean.editProfile(request.remoteUser)}"      value="Editar"  class="btn green"   >

                                </h:commandButton>

                            </div>
                        </div>
                    </h:form>
                </div>
            </div>
        </div>
        <div jsf:id="conta" style='display:none;'>
            <div class="row card light-green lighten-3"   >
                <div class="col s12 offset-s4" style="margin-top: 1em"><h4>Resumo da Conta</h4></div>
                <div class="col s12" style="padding: 3em 1em 1em 1em"  >
                    <div class="col s12 center" jsf:id="data">
                        <img id="img-no-excel" src="/images/#{userBean.avatar(request.remoteUser)}" style="max-height: 200px; max-width: 200px;"/>
                    </div>
                    <div class="col s8 m9 left flow-text">

                        <span class="ne-user-title">RA|CPF:</span> <h:outputText style="margin-left: 220px;"  value="#{request.remoteUser}"/><br/>
                        <span class="ne-user-title">Nome:</span> <h:outputText style="margin-left: 240px;" value="#{userBean.getByra(request.remoteUser)}" /><br/>
                        <span class="ne-user-title">Email</span> <h:outputText style="margin-left: 250px;" value="#{userBean.getEmailByra(request.remoteUser)}" /><br/>
                        <span class="ne-user-title">Saldo:</span> <h:outputText style="margin-left: 243px;" value="#{userBean.getBalanceByra(request.remoteUser)}" /><br/>
                        <span class="ne-user-title">Tipo de Conta</span> <h:outputText style="margin-left: 158px;" value="#{userBean.getTypeByra(request.remoteUser).toLowerCase()}" /><br/>
                        <span class="ne-user-title">Estado da conta</span> <h:outputText style="margin-left: 158px;" value="#" /><br/>
                        <span class="ne-user-title" style="margin-left: 10em; font-size: 1.35em;">Inserir Credito</span>
                    </div>



                </div>

            </div>
        </div>



        <div jsf:id="extrato" style='display:none;'>
            <div class="row card blue lighten-3"   >
                <div class="col s12 offset-s5" style="margin-top: 1em"><h4>Extrato</h4></div>
                <div class="col s12" style="padding: 3em 1em 1em 1em"  >


                    <h:form id="tabela" prependId="false"  >

                        <div class="row">
                            <div class="col s12">
                                <p:dataTable var="transaction" value="#{transactionBean.findAll(request.remoteUser)}"   paginator="true"
                                             paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                             rowsPerPageTemplate="5,10,15" rows="4"  >

                                    <p:column headerText="Data" class="center-align" sortBy="#{transaction.data}" filterBy="#{transaction.data}" filterMatchMode="contains"  >
                                        <h:outputText value="#{transaction.data}"  />
                                    </p:column>
                                    <p:column headerText="Operador" class="center-align" sortBy="#{transactionBean.getbyManager(transaction)}" filterBy="#{transactionBean.getbyManager(transaction)}" filterMatchMode="contains"  >
                                        <h:outputText value="#{transactionBean.getbyManager(transaction)}"  />
                                    </p:column>

                                    <p:column headerText="Produtos Consumidos" >
                                        <table>

                                            <ui:repeat var="group"  value="#{transactionBean.findProducts(transaction.id)}">
                                                <tr>
                                                    <td> <h:outputText value="#{productBean.findByid(group.product.id).getName()}" /></td>
                                                    <td> R$-<h:outputText  value="#{productBean.findByid(group.product.id).getValue()}" /></td>

                                                </tr>
                                            </ui:repeat>
                                            <ui:repeat var="group" rendered="#{transaction.value>0}"  value="#{transactionBean.findProducts(transaction.id) == null}">
                                                <tr>
                                                    <td> <h:outputText value="Adiçao" /></td>
                                                    <td> R$+<h:outputText  value="#{transaction.value}" /></td>

                                                </tr>
                                            </ui:repeat>

                                        </table>
                                    </p:column>
                                    <p:column headerText="Valor Total" class="center-align"  sortBy="#{transaction.value}" filterBy="#{transaction.value}" filterMatchMode="contains"  >
                                        <h:outputText value="#{transaction.value}" />
                                        <input type="hidden" name="valor" value="#{transaction.value}" />
                                    </p:column>

                                </p:dataTable>
                            </div>
                        </div>
                    </h:form>
                </div>
            </div>
        </div>


    </ui:define>
</ui:composition>